{{ define "main" }}

<style>
/* FAQ Layout Styles */
.faq-hero {
	/* display: flex;
	align-items: center;
	justify-content: center; */
	/* text-align: center; */
	padding: 10px 20px;
	/* background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); */
	/* color: white; */
	color: black;
	margin-bottom: 0;
}

.faq-hero h1 {
	margin: 0;
	font-size: 1.5rem;
}

.faq-container {
	display: flex;
	max-width: 1400px;
	margin: 0 auto;
	/* padding: 40px 20px; */
	gap: 40px;
	position: relative;
}

/* Fixed Sidebar */
.faq-sidebar {
	width: 280px;
	flex-shrink: 0;
	position: absolute;
	top: 0;
	left: 0;
	max-height: calc(100vh - 140px);
	overflow-y: auto;
	background: #f8f9fa;
	border-radius: 12px;
	padding: 32px 24px 24px 24px;
	box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
	z-index: 1;
	transition: position 0.1s ease;
}

.faq-sidebar.is-fixed {
	position: fixed;
	top: 100px;
	/* left: max(20px, calc((100vw - 1400px) / 2 + 20px)); */
	left: 20px;
	z-index: 1;
}
.faq-nav h3 {
	margin-top: 0;
	margin-bottom: 8px;
	font-size: 1.1rem;
	color: #333;
	border-bottom: 2px solid #667eea;
	padding-top: 0;
	padding-bottom: 8px;
}

.faq-nav h3::before,
.faq-nav h3::after {
	content: none !important;
	display: none !important;
}

.faq-nav .faq-topics {
	list-style: none;
	padding-left: 0;
	margin: 0;
	margin-top: 0;
}

.faq-nav .faq-topics::before,
.faq-nav .faq-topics::after {
	content: none !important;
	display: none !important;
}

.faq-nav .faq-topics li {
	margin-bottom: 8px;
}

.faq-nav .faq-topics li::before,
.faq-nav .faq-topics li::after {
	content: none !important;
	display: none !important;
}

.faq-nav .faq-topics a {
	display: block;
	padding: 8px 12px;
	color: #555;
	text-decoration: none;
	border-radius: 6px;
	transition: all 0.2s ease;
	line-height: 1.4;
}

.faq-nav .faq-topics a:hover {
	background: #e9ecef;
	color: #667eea;
	transform: translateX(4px);
}

.faq-nav .faq-topics a.active {
	background: #667eea;
	color: white;
	font-weight: 600;
}

/* Custom scrollbar for sidebar */
.faq-sidebar::-webkit-scrollbar {
	width: 6px;
}

.faq-sidebar::-webkit-scrollbar-track {
	background: #f1f1f1;
	border-radius: 10px;
}

.faq-sidebar::-webkit-scrollbar-thumb {
	background: #667eea;
	border-radius: 10px;
}

.faq-sidebar::-webkit-scrollbar-thumb:hover {
	background: #764ba2;
}

/* Main Content Area */
.faq-content {
	flex: 1;
	min-width: 0;
	margin-left: 320px;
	background: white;
	border-radius: 12px;
	padding: 32px;
	box-shadow: 0 2px 12px rgba(0, 0, 0, 0.06);
}

.faq-content h2 {
	color: #667eea;
	margin-top: 48px;
	margin-bottom: 24px;
	padding-bottom: 12px;
	border-bottom: 2px solid #e9ecef;
	font-size: 1.8rem;
}

.faq-content h2::before,
.faq-content h2::after {
	content: none !important;
	display: none !important;
}

.faq-content h2:first-child {
	margin-top: 0;
}

.faq-content h3 {
	color: #333;
	margin-top: 16px;
	margin-bottom: 0;
	font-size: 1.3rem;
	cursor: pointer;
	position: relative;
	padding: 20px;
	padding-right: 50px;
	transition: all 0.2s ease;
	user-select: none;
	background: white;
	border: 1px solid #e0e0e0;
	border-radius: 8px;
}

.faq-content h3::before {
	content: none !important;
	display: none !important;
}

.faq-content h3:hover {
	color: #667eea;
	border-color: #667eea;
	background: #f8f9ff;
}

.faq-content h3:hover + .faq-answer.open {
	border-color: #667eea;
}

.faq-content h3::after {
	content: '+' !important;
	position: absolute;
	right: 20px;
	font-size: 1.5rem;
	font-weight: bold;
	color: #667eea;
}

.faq-content h3.expanded::after {
	content: 'âˆ’' !important;
	transform: rotate(180deg);
}

.faq-content h3.expanded {
	border-bottom-left-radius: 0;
	border-bottom-right-radius: 0;
	border-bottom: none;
	border-color: #667eea;
	color: #667eea;
	background: #f8f9ff;
}
.faq-answer {
	max-height: 0;
	overflow: hidden;
	margin-bottom: 0;
	opacity: 0;
	border: 1px solid #e0e0e0;
	border-top: none;
	border-bottom-left-radius: 8px;
	border-bottom-right-radius: 8px;
	background: white;
	transition: border-color 0.2s ease;
}

.faq-answer.open {
	max-height: 2000px;
	margin-bottom: 16px;
	opacity: 1;
	padding: 20px;
	padding-top: 0;
	border-color: #667eea;
}

.faq-answer.open:hover {
	border-color: #667eea;
}

.faq-content h3.expanded:has(+ .faq-answer.open:hover) {
	border-color: #667eea;
	color: #667eea;
	background: #f8f9ff;
}

.faq-answer p:first-child {
	margin-top: 16px;
}

.faq-answer p:last-child {
	margin-bottom: 0;
}

.faq-content p {
	line-height: 1.7;
	color: #555;
	margin-bottom: 8px;
	margin-top: 8px;
}

.faq-content p::before,
.faq-content p::after {
	content: none !important;
	display: none !important;
}

.faq-content a {
	color: #667eea;
	text-decoration: none;
	border-bottom: 1px solid transparent;
	transition: border-color 0.2s ease;
}

.faq-content a:hover {
	border-bottom-color: #667eea;
}

/* Responsive Design */
@media (max-width: 1024px) {
	.faq-sidebar {
		width: 240px;
	}
	
	.faq-content {
		margin-left: 0;
	}
	
	.faq-container {
		gap: 30px;
		padding: 30px 15px;
	}
}

@media (max-width: 768px) {
	.faq-container {
		flex-direction: column;
		gap: 20px;
	}
	
	.faq-sidebar {
		position: sticky !important;
		left: auto !important;
		top: 100px !important;
		width: 100%;
		max-height: 50vh;
		order: -1;
		z-index: 10;
	}
	
	.faq-sidebar.is-fixed {
		position: sticky !important;
		left: auto !important;
		top: 100px !important;
	}
	
	.faq-nav nav {
		max-height: 300px;
		overflow-y: auto;
	}
	
	.faq-content {
		margin-left: 0;
		margin-top: 0;
		padding: 24px 20px;
	}
	
	.faq-hero h1 {
		font-size: 2rem;
	}
}
</style>

<div class="hero faq-hero">
	<h1>{{ .Title }}</h1>
</div>

<div class="faq-container">
	<!-- Fixed Side Menu -->
	<aside class="faq-sidebar">
		<nav class="faq-nav">
			<h3>Quick Navigation</h3>
			<ul class="faq-topics" id="faq-nav-list">
				<!-- Navigation will be populated by JavaScript -->
			</ul>
		</nav>
	</aside>

	<!-- Main FAQ Content -->
	<section class="faq-content">
		{{ .Content }}
	</section>

</div>

<!-- Empty spacing section -->
<div style="height: 300px;"></div>	

<script>
	// Build navigation from h2 headings only (main topics)
	document.addEventListener('DOMContentLoaded', function() {
		const navList = document.getElementById('faq-nav-list');
		const faqContent = document.querySelector('.faq-content');
		const sidebar = document.querySelector('.faq-sidebar');
		const container = document.querySelector('.faq-container');
		
		// Calculate initial sidebar position
		const sidebarInitialTop = sidebar.offsetTop;
		const menuBarHeight = 100; // Distance from top where sidebar should become fixed
		
		// Handle scroll to make sidebar sticky
		function handleSidebarScroll() {
			const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
			const containerTop = container.offsetTop;
			const sidebarShouldStick = scrollTop >= (containerTop - menuBarHeight);
			
			if (sidebarShouldStick) {
				sidebar.classList.add('is-fixed');
			} else {
				sidebar.classList.remove('is-fixed');
			}
		}
		
		// Listen to scroll events
		window.addEventListener('scroll', handleSidebarScroll);
		handleSidebarScroll(); // Initial check
		
		// Get all headings
		const allHeadings = faqContent.querySelectorAll('h2, h3');
		
		// Track which h2s are actually main sections (## in markdown)
		// Main sections are h2s that are NOT preceded by another h2 without content between
		const mainH2s = [];
		let lastH2 = null;
		
		allHeadings.forEach((heading, index) => {
			if (heading.tagName === 'H2') {
				// Check if there's an h3 between this h2 and the next h2
				let nextSibling = heading.nextElementSibling;
				let hasH3OrContent = false;
				
				while (nextSibling && nextSibling.tagName !== 'H2') {
					if (nextSibling.tagName === 'H3' || 
					    (nextSibling.tagName === 'P' && nextSibling.textContent.trim().length > 0)) {
						hasH3OrContent = true;
						break;
					}
					nextSibling = nextSibling.nextElementSibling;
				}
				
				// This is a main section if it has h3 children or paragraph content
				if (hasH3OrContent) {
					mainH2s.push(heading);
				}
			}
		});
		
		// Create navigation items for main sections only
		mainH2s.forEach(heading => {
			const li = document.createElement('li');
			const a = document.createElement('a');
			a.href = '#' + heading.id;
			a.textContent = heading.textContent;
			li.appendChild(a);
			navList.appendChild(li);
		});
		
		// Make FAQ questions collapsible
		const h3Questions = faqContent.querySelectorAll('h3');
		h3Questions.forEach(h3 => {
			// Wrap content after h3 until next heading
			const answerContent = [];
			let nextElement = h3.nextElementSibling;
			
			while (nextElement && nextElement.tagName !== 'H2' && nextElement.tagName !== 'H3') {
				answerContent.push(nextElement);
				nextElement = nextElement.nextElementSibling;
			}
			
			// Create wrapper for answer content
			if (answerContent.length > 0) {
				const wrapper = document.createElement('div');
				wrapper.className = 'faq-answer';
				
				answerContent.forEach(element => {
					wrapper.appendChild(element.cloneNode(true));
					element.remove();
				});
				
				h3.parentNode.insertBefore(wrapper, h3.nextSibling);
				
				// Add click handler
				h3.addEventListener('click', function() {
					this.classList.toggle('expanded');
					wrapper.classList.toggle('open');
				});
			}
		});
		
		// Now set up smooth scrolling
		const sidebarLinks = document.querySelectorAll('.faq-sidebar a[href^="#"]');
		
		sidebarLinks.forEach(link => {
			link.addEventListener('click', function(e) {
				e.preventDefault();
				const targetId = this.getAttribute('href');
				const targetElement = document.querySelector(targetId);
				
				if (targetElement) {
					// Offset for fixed header
					const headerOffset = 100;
					const elementPosition = targetElement.getBoundingClientRect().top;
					const offsetPosition = elementPosition + window.pageYOffset - headerOffset;
					
					window.scrollTo({
						top: offsetPosition,
						behavior: 'smooth'
					});
					
					// Update active link
					sidebarLinks.forEach(l => l.classList.remove('active'));
					this.classList.add('active');
				}
			});
		});
		
		// Highlight active section on scroll (only observe main sections)
		const observer = new IntersectionObserver((entries) => {
			entries.forEach(entry => {
				if (entry.isIntersecting) {
					const id = entry.target.getAttribute('id');
					if (id) {
						sidebarLinks.forEach(link => {
							link.classList.remove('active');
							if (link.getAttribute('href') === `#${id}`) {
								link.classList.add('active');
							}
						});
					}
				}
			});
		}, {
			rootMargin: '-100px 0px -70% 0px'
		});
		
		// Observe only the main section headings
		mainH2s.forEach((heading) => {
			observer.observe(heading);
		});
	});
</script>

{{ end }}
